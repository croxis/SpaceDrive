
name: Color Correction
author: tobspr <tobias.springer1@gmail.com>
version: 1.0
description: >
    This plugin adds support for color correction, vignetting and chromatic
    abberation.

settings: !!omap

    - tonemap_operator:
        type: enum
        values: [optimized, reinhard, uncharted2, exponential, srgb, none]
        default: uncharted2
        label: Tonemap Operator
        shader_runtime: true
        description: >
            This specifies the tonemapping operator, all operators implement
            sRGB color correction as well, except for the none operator which
            just passes through the color. None and SRGB are just for reference,
            and should not be used.

    # Reinhard Tonemapping settings

    - reinhard_version:
        display_if: {tonemap_operator: "reinhard"}
        type: enum
        values: [rgb, luminance, white_preserve, luminosity]
        default: rgb
        shader_runtime: true
        label: Reinhard Version
        description: >
            Choose between different versions of the Reinhard Operator. rgb performs
            the operator on the rgb value, luminance on the brightness of the color.
            white_preserve also uses the luma value, but tries to preserve the whites.

    # Exponential Tonemapping settings

    - exponential_factor:
        display_if: {tonemap_operator: "exponential"}
        type: float
        range: [0.01, 5.0]
        default: 0.5
        shader_runtime: true
        label: Exponential factor
        description: >
            The factor for the exponential mapping. Assuming the factor is named
            f, then the output color is computed with 1 - exp(-f*color).


    # Uncharted 2 Tonemapping settings

    - uc2t_shoulder_strength:
        display_if: {tonemap_operator: "uncharted2"}
        type: float
        range: [0.01, 1.0]
        default: 0.22
        shader_runtime: true
        label: UC2 Shoulder Strength
        description: >
            Shoulder Strength, controls the appearance of the bright parts
            of the image (the last part of the color curve).

    - uc2t_linear_strength:
        display_if: {tonemap_operator: "uncharted2"}
        type: float
        range: [0.01, 1.0]
        default: 0.3
        shader_runtime: true
        label: UC2 Linear Strength
        description: >
            Linear factor, higher values produce a more grayish image, while
            lower values produce a more saturated image.

    - uc2t_linear_angle:
        display_if: {tonemap_operator: "uncharted2"}
        type: float
        range: [0.01, 1.0]
        default: 0.1
        shader_runtime: true
        label: UC2 Linear Angle
        description: >
            Linear Angle, higher values produce a brighter but more grayish image,
            lower values produce a more saturated image.


    - uc2t_toe_strength:
        display_if: {tonemap_operator: "uncharted2"}
        type: float
        range: [0.01, 1.0]
        default: 0.2
        shader_runtime: true
        label: UC2 Toe Strength
        description: >
            Toe Strength, controls the appearance of the dark parts of the image,
            (the first part of the color curve). Higher values mean more dark
            spots, while lower values will cut-off less dark values.

    - uc2t_toe_numerator:
        display_if: {tonemap_operator: "uncharted2"}
        type: float
        range: [0.0001, 0.1]
        default: 0.01
        shader_runtime: true
        label: UC2 Toe Numerator
        description: >
            Toe Numerator, controls the appearance of the dark parts similar to
            the toe strength. This is a bias, values below this setting are
            completely dark.

    - uc2t_toe_denumerator: 
        display_if: {tonemap_operator: "uncharted2"}
        type: float
        range: [0.01, 1.0]
        default: 0.3
        shader_runtime: true
        label: UC2 Toe Denumerator
        description: >
            Toe Denumerator, controls the appearance of the dark parts similar to
            the toe strength, but instead of cutting of the dark values it
            makes them brighter.

    - uc2t_reference_white:
        display_if: {tonemap_operator: "uncharted2"}
        type: float
        range: [0.1, 20.0]
        default: 11.2
        shader_runtime: true
        label: UC2 Reference White
        description: >
            Reference White, higher values will produce a darker image, and 
            vice-versa. This basically just scales the color linear inverse.


    - vignette_strength:
        type: float
        range: [0.0, 1.0]
        default: 0.5
        shader_runtime: true
        label: Vignette Strength
        description: >
            Controls the strength of the vignette, which darkens the corners
            of the image. A strength of 0 means no vignette, a strength of 1
            means a almost completely black vignette. 

    - film_grain_strength:
        type: float
        range: [0.0, 1.0]
        default: 0.125
        shader_runtime: true
        label: Film Grain Strength
        description: >
            Controls the strength of the film grain, which simulates the inaccuracies
            on a film. This is also useful to add some more details to textures, however
            care to not overdo the effect.


    # Color LUT

    - color_lut:
        type: image
        default: ColorLUT.png    
        label: Color LUT
        description: >
            Specifies a Color LUT (Look-Up-Table) to use. Have a look at the Render Pipeline
            documentation for further information.


    # Chromatic aberration

    - use_chromatic_aberration:
        type: bool
        default: true
        shader_runtime: true
        label: Enable Chromatic Aberration
        description: >  
            Enables chromatic aberration, a camera effect caused due to the 
            different refraction of the wavelengths through a lens. 

    - chromatic_aberration_strength:
        display_if: {use_chromatic_aberration: true}
        type: float
        range: [0.1, 2.0]
        default: 1.0
        shader_runtime: true
        label: Chromatic Aberration Strength
        description: >
            Strength of the chromatic abberation, you should not overdo this since
            it can lead to very unrealistic results fast.

    - chromatic_aberration_samples:
        display_if: {use_chromatic_aberration: true}
        type: int
        range: [1, 5]
        default: 2
        shader_runtime: true
        label: Chromatic Aberration Samples
        description: >
            Amount of samples to use for blurring the screen edges when using
            chromatic abberation. A higher amount of samples produces a smoother
            blur but also increases the performance cost by a lot.


    # Automatic exposure settings


    - use_auto_exposure:
        type: bool
        default: true
        label: Enable Automatic Exposure
        description: >
            Enables automatic exposure (Also called Retinex Effect), this downscales
            the scene to get the average brightness, and adjusts the exposure
            automaticall based on that.

    - min_exposure:
        display_if: {use_auto_exposure: true}
        type: float
        range: [0.00001, 1.0]
        default: 0.01
        label: Minimum Exposure
        shader_runtime: true
        description: >
            The minimum exposure, this prevents the automatic exposure from overfitting
            on bright areas

    - max_exposure:
        display_if: {use_auto_exposure: true}
        type: float
        range: [0.05, 7.0]
        default: 5.0
        shader_runtime: true
        label: Maximum Exposure
        description: >
            The maximum exposure, this prevents the automatic exposure from overfitting
            on dark areas.

    - exposure_bias:
        display_if: {use_auto_exposure: true}
        type: float
        range: [-1.0, 1.0]
        default: 0.0
        label: Exposure Bias
        shader_runtime: true
        description: >
            This is a fixed value which gets added to the average brightness of the
            scene. A value greater 0 will decrease the scene brightness, while a value
            smaller than 0 will increase it.

    - brightness_adaption_rate:
        display_if: {use_auto_exposure: true}
        type: float
        range: [0.01, 5.0]
        default: 2.0
        shader_runtime: true
        label: Brightness Adaption Rate
        description: >
            Adaption rate when moving from dark to bright areas.
            Usually faster (= higher) than the rate when moving from bright to dark areas.

    - darkness_adaption_rate:
        display_if: {use_auto_exposure: true}
        type: float
        range: [0.01, 5.0]
        default: 1.0
        shader_runtime: true
        label: Darkness Adaption Rate
        description: >
            Adaption rate when moving from bright to dark areas.
            Usually slower (= smaller) than the rate when moving from dark to bright areas.



daytime_settings: !!omap
    
    - exposure_scale:
        type: scalar
        unit: percent
        range: [0.01, 5]
        default: 2.0
        label: Exposure Scale
        description: Scales the exposure by a fixed value.

